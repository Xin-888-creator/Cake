<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magic Photo Cake - Birthday Mode</title>

<style>
body{
    margin:0;
    overflow:hidden;
    background:radial-gradient(circle at center,#1a0510 0%,#000 100%);
    font-family:Arial,sans-serif;
}
#top-header{
    position:absolute;top:15px;width:100%;text-align:center;z-index:50;
    pointer-events:none;
}
#top-header h1{
    font-family:'Brush Script MT',cursive;
    font-size:55px;margin:0;
    background:linear-gradient(to bottom,#fff,#ff69b4);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    filter:drop-shadow(0 0 15px rgba(255,105,180,.6));
    animation:floatText 4s ease-in-out infinite;
}
@keyframes floatText{
    0%,100%{transform:translateY(0)}
    50%{transform:translateY(-8px)}
}
#ui-container{
    position:absolute;top:120px;left:20px;width:260px;
    padding:20px;
    background:rgba(255,255,255,.05);
    backdrop-filter:blur(12px);
    border-radius:16px;
    border:1px solid rgba(255,182,193,.3);
    color:#fff;z-index:100;
    display:flex;flex-direction:column;gap:15px;
}
#video-wrapper{
    width:100%;height:160px;border-radius:10px;
    overflow:hidden;background:#000;transform:scaleX(-1);
}
video{width:100%;height:100%;object-fit:cover}
.status-badge{
    position:absolute;top:8px;right:8px;
    background:#ff69b4;color:#fff;
    padding:3px 8px;border-radius:4px;
    font-size:11px;display:none;
}
.file-upload{
    background:rgba(255,105,180,.2);
    border:1px solid rgba(255,105,180,.4);
    padding:10px;border-radius:8px;
    text-align:center;font-weight:bold;
    cursor:pointer;
}
input[type=file]{display:none}
#gesture-info{
    font-size:11px;color:#ffc0cb;
    background:rgba(0,0,0,.4);
    padding:12px;border-radius:8px;
}
#loader{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:#000;display:flex;
    justify-content:center;align-items:center;
    flex-direction:column;color:#ff69b4;z-index:999;
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
</head>

<body>

<div id="top-header"><h1>Happy Birthday</h1></div>

<div id="loader">
<h2>ğŸ‚ ç”Ÿæ—¥è›‹ç³•ç³»ç»Ÿåˆå§‹åŒ–...</h2>
<p>å¼€å¯æ‘„åƒå¤´ä»¥å¯ç”¨é­”æ³•</p>
</div>

<div id="ui-container">
<div id="video-wrapper">
<video id="input_video"></video>
<div id="status-text" class="status-badge">Ready</div>
</div>
<label class="file-upload" for="photo-input">ğŸ“· ä¸Šä¼ ç…§ç‰‡è£…é¥°è›‹ç³•</label>
<input type="file" id="photo-input" multiple>
<div id="gesture-info">
âœ‹ å¼ å¼€ï¼šç…§ç‰‡çˆ†å‘<br>
âœŠ æ¡æ‹³ï¼šç”Ÿæˆè›‹ç³•<br>
â˜ï¸ å•æŒ‡ï¼šç…§ç‰‡ç‰¹å†™<br>
ğŸ‘Œ OKï¼šç”Ÿæ—¥å¿«ä¹æ–‡å­—
</div>
</div>

<script>
/* ===== THREE åœºæ™¯ ===== */
const scene=new THREE.Scene();
scene.fog=new THREE.FogExp2(0x1a0510,.002);

const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,.1,1000);
camera.position.z=85;

const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* ç¯å…‰ */
scene.add(new THREE.AmbientLight(0xffffff,.6));
const candleLight=new THREE.PointLight(0xffaa55,2,150);
candleLight.position.set(0,40,40);
scene.add(candleLight);

/* ===== ğŸ‚ è›‹ç³•ä¸»ä½“ï¼ˆæ”¹è¿™é‡Œï¼‰ ===== */
const cakeGroup=new THREE.Group();
scene.add(cakeGroup);

/* è›‹ç³•ç›˜ */
const plate=new THREE.Mesh(
    new THREE.CylinderGeometry(26,26,2,64),
    new THREE.MeshStandardMaterial({
        color:0xdddddd,
        metalness:.7,
        roughness:.3
    })
);
plate.position.y=-18;
cakeGroup.add(plate);

/* è›‹ç³•ä¸‰å±‚ */
function makeLayer(r,h,color,y){
    const mesh=new THREE.Mesh(
        new THREE.CylinderGeometry(r,r,h,64),
        new THREE.MeshStandardMaterial({
            color,
            roughness:.4
        })
    );
    mesh.position.y=y;
    cakeGroup.add(mesh);
}

makeLayer(22,8,0xffe4e1,-12);
makeLayer(16,7,0xffb6c1,-4);
makeLayer(10,6,0xfffff0,4);

/* ç³–éœœæ¡çº¹ */
const icingGeo=new THREE.TorusGeometry(22,.4,8,64);
const icingMat=new THREE.MeshStandardMaterial({color:0xff69b4});
for(let i=0;i<12;i++){
    const ring=new THREE.Mesh(icingGeo,icingMat);
    ring.rotation.x=Math.PI/2;
    ring.position.y=-15+i*1.2;
    ring.scale.setScalar(1-(i*.03));
    cakeGroup.add(ring);
}

/* èœ¡çƒ› */
const candle=new THREE.Mesh(
    new THREE.CylinderGeometry(.6,.6,6,16),
    new THREE.MeshStandardMaterial({color:0xffffff})
);
candle.position.y=10;
cakeGroup.add(candle);

/* ç«ç„° */
const flame=new THREE.Mesh(
    new THREE.ConeGeometry(1.2,3,16),
    new THREE.MeshStandardMaterial({
        color:0xff4500,
        emissive:0xff2200,
        emissiveIntensity:2
    })
);
flame.position.y=14;
cakeGroup.add(flame);

/* ===== åŠ¨ç”» ===== */
function animate(){
    requestAnimationFrame(animate);
    cakeGroup.rotation.y+=0.003;
    flame.scale.y=1+Math.sin(Date.now()*0.01)*.15;
    renderer.render(scene,camera);
}
animate();

window.addEventListener('resize',()=>{
    camera.aspect=innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth,innerHeight);
});

/* ===== æ‘„åƒå¤´ï¼ˆä¿æŒåŸé€»è¾‘ï¼‰ ===== */
const video=document.getElementById('input_video');
const hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
hands.setOptions({maxNumHands:1});
hands.onResults(()=>{
    document.getElementById('loader').style.display='none';
});
const cam=new Camera(video,{
    onFrame:async()=>{await hands.send({image:video})},
    width:320,height:240
});
cam.start();
</script>

</body>
</html>
